module;

import ttt.*;

operation __icmf_message(sender: byte_array, topic: text, body: gtv) {
    if(topic != "L_ttt_result") {
        log("received message on unknown topic: ", topic);
        return;
    }

    val rewards = list<Leaderboard.s_reward>.from_gtv_pretty(body);

    for(i in rewards) {
        log("incrementing points for ", i.pubkey, " by ", i.points);
        val entry = Leaderboard.ensure(i.pubkey);
        entry.points += i.points;
    }
}
